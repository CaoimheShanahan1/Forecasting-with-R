---
title: "AR models  "
author: "Rozenn Dahyot - https://www.scss.tcd.ie/Rozenn.Dahyot/"
date: "8 October 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Definition Autoregressive model order 1

An AR(1) is defined as: 
$$
y_t = \phi_0 +\phi_1 \ y_{t-1} +\epsilon_t
$$
with the following assumptions $\forall t$:

- $\mathbb{E}[\epsilon_t]= 0$, $\mathbb{V}[\epsilon_t]= \sigma_{\epsilon}^2$ and the errors $\epsilon_{t_1}$ and $\epsilon_{t_2}$ are independent $\forall t_1\neq t_2$.
- $\mathbb{E}[y_t]= \mu_y$ (stationary in mean). It can be shown $\mu_t=\frac{\phi_0}{1-\phi_1}$
- $\mathbb{V}[y_t]= \sigma_y^2$ (stationary in variance). It can be shown $\sigma_y^2=\frac{\sigma_{\epsilon}^2}{1-\phi_1^2}$ imposing the constraint $-1<\phi_1<1$.


AR(1) can be rewritten:
$$
y_t-\mu_y= \phi_1 \ (y_{t-1}-\mu_y) +\epsilon_t
$$
and it can be shown that the covariance between $y_t$ and $y_{t-k}$ is:
$$
\mathbb{C}\text{ov}[y_t,y_{t-k}]=(\phi_1)^k \ \sigma_y^2
$$
and consequently the correlation between $y_t$ and $y_{t-k}$ is:
$$
\mathbb{C}\text{or}[y_t,y_{t-k}]=(\phi_1)^k 
$$

### ACF of AR(1)


This autocorrelation formula explains the 'exponential decrease' like shape of the ACF (for $0<\phi_1<1$) simulated below since $ACF(k)=(\phi_1)^k$:

```{r,warning=FALSE, message=FALSE}
require(fma)
tsdisplay(arima.sim(n=10000,list(ar = c(0.8897)), sd = sqrt(0.1796)))

```

For $-1<\phi_1<0$, a 'damped sine wave' appears for the ACF: 

```{r,warning=FALSE, message=FALSE}
require(fma)
tsdisplay(arima.sim(n=10000,list(ar = c(-0.8897)), sd = sqrt(0.1796)))

```




### PACF of AR(1)

An AR(1) model can be rewritten as an AR(p):
$$
y_t = \phi_0 +\phi_1 \ y_{t-1} +0 \ y_{t-2}+\cdots +0 \ y_{t-p} + \epsilon_t
$$
defining $PACF(1)=\phi_1$, $PACF(2)=0$ ...$PACF(p)=0$ using the parameters associated with the explanatory variables $y_{t-1}$, $y_{t-2}$ ... $y_{t-p}$.

Both ACF and PACF can be used for recognising an AR model (and finding its order $p$).


## AR(2) model



AR(2) can be written $\forall t$:
$$
y_t= \phi_0 + \phi_1 \ y_{t-1} + \phi_2 \ y_{t-2} +\epsilon_t
$$
where $y_t$ is stationary in mean and variance  . $\mathbb{E}[y_y]=\mu_y=\frac{\phi_0}{1-\phi_1-\phi_2}$ and the model can be written:
$$
y_t-\mu_y= \phi_1 \ (y_{t-1}-\mu_y) +\phi_2 \ (y_{t-2}-\mu_y) +\epsilon_t
$$


### Simulated AR(2)



Below  is a plot of a simulated time series that follows an AR(2) model with
$\phi_1=0.8897$  and $\phi_2=-0.5$. Note how the PACF(1) and PACF(2) are not zeroes while all others coefficients PACF(k) are for $k>2$. The ACF displays a damped sine wave and the  time plot shows a contant mean and variance over time (as expected from AR(2)).

```{r,warning=FALSE, message=FALSE}
require(fma)
tsdisplay(arima.sim(n=10000,list(ar = c(0.8897,-0.5)), sd = sqrt(0.1796)))

```

**Exercise:** What contraint is there on the parameters $\phi_1$ and $\phi_2$ in an AR(2) ? 
(see  https://otexts.com/fpp2/AR.html ).


## Yule Walker equations to estimate parameters

- Multiplying by $(y_{t-1}-\mu_y)$ the AR(2) model equation we have:
$$
(y_t-\mu_y)\ (y_{t-1}-\mu_y)= (\phi_1 \ (y_{t-1}-\mu_y) +\phi_2 \ (y_{t-2}-\mu_y) +\epsilon_t) \ (y_{t-1}-\mu_y)
$$
and taking the expectation:
$$
\underbrace{\mathbb{E}[(y_t-\mu_y)\ (y_{t-1}-\mu_y)]}_{=\gamma_1}= \phi_1 \ \underbrace{\mathbb{E}[(y_{t-1}-\mu_y)) \ (y_{t-1}-\mu_y)]}_{=\gamma_0=\sigma_y^2} +\phi_2 \ \underbrace{\mathbb{E}[(y_{t-2}-\mu_y) \ (y_{t-1}-\mu_y)]}_{=\gamma_1} +\underbrace{\mathbb{E}[\epsilon_t \ (y_{t-1}-\mu_y)]}_{=0}
$$
- Multiplying by $(y_{t-2}-\mu_y)$ the AR(2) model equation and taking the expectation leads to :
$$
\gamma_2=\phi_1 \ \gamma_1 + \phi_2 \ \gamma_0
$$
These 2 (Yule-Walker) equations provide a mean to estimate $\phi_1$ and $\phi_2$ using estimates of the variance $\sigma_y^2=\gamma_0$ and covariances $\gamma_1,\gamma_2$:
$$
\left \lbrack
\begin{array}{cc}
\gamma_0 & \gamma_1\\
\gamma_1 & \gamma_0 \\
\end{array}
\right\rbrack
\left(  
\begin{array}{c}
\phi_1 \\
\phi_2 \\
\end{array}
\right) = 
\left(  
\begin{array}{c}
\gamma_1 \\
\gamma_2 \\
\end{array}
\right)
$$


